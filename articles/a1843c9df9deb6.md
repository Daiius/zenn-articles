---
title: "React (SPA) ã®æ„Ÿè¦šã‹ã‚‰ Next.js ã®æ„Ÿè¦šã«åˆ‡ã‚Šæ›¿ãˆã‚‹è©±"
emoji: "ğŸ”"
type: "tech"
topics:
  - "nextjs"
  - "react"
  - "spa"
published: true
published_at: "2024-07-22 16:11"
---

# Todoã‚¢ãƒ—ãƒªä½œæˆã‚’é¡Œæã« React SPA ã¨ Next.js ã®<br>ãƒ‡ãƒ¼ã‚¿å–å¾—å‘¨ã‚Šã®é•ã„ã‚’ã¾ã¨ã‚ã¾ã™
React (SPA) + Web API (Python, Flask) + MySQL ã®3å±¤æ§‹æˆWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ã„ãŸã®ã§ã™ãŒã€**Next.jsã‚’å‹‰å¼·ã—å§‹ã‚ã‚‹ã¨SPAã¨ã ã„ã¶æ„Ÿè¦šãŒç•°ãªã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸ**ã€‚

ç‹¬å­¦ã§Next.jsã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰çœºã‚ã¦ã„ãŸã®ã§ã™ãŒã€**SPAã®æ„Ÿè¦šãŒæŠœã‘ãšã«Next.jsã‚‰ã—ããªã„Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ã„ã¾ã—ãŸ**ã€‚

ã‚‚ã¡ã‚ã‚“Next.jsã‚’ä½¿ã£ã¦ã‚‚SPAæ–¹å¼ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚Œã¾ã™ã—ã€å®Ÿè£…æ–¹æ³•ã«å”¯ä¸€ã®æ­£è§£ã¯ç„¡ã„ã¨ã¯æ€ã†ã®ã§ã™ãŒã€Next.jså…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚ã‚ã‚‹ **ã€Œã‚µãƒ¼ãƒâ†”ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã®å¾€å¾©å›æ•°ã‚’æ¸›ã‚‰ã™ã€ã“ã¨ã‚’æ„è­˜ã—ã¦å®Ÿè£…ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰é‡ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ä¾å­˜æ€§ã‚’æ¸›ã‚‰ã—ãŸNext.jsã‚‰ã—ã„å½¢ã«ã§ããã†** ãªæ„Ÿè¦šã‚’æŒã¤ã«è‡³ã‚Šã¾ã—ãŸã€‚
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã©ã®è¾ºã«è¨˜è¿°ãŒæœ‰ã£ãŸã‹æ­£ç¢ºã«æ€ã„å‡ºã›ã¦ã„ã¾ã›ã‚“ãŒ...[ã“ã®ã¸ã‚“](https://nextjs.org/docs/app/building-your-application/data-fetching/patterns)ã§ã—ã‚‡ã†ã‹...

**ã“ã®è¨˜äº‹ã¯Reactã«ã‚ˆã‚‹SPAã¨Next.jsçš„ãªæ§‹æˆã¨ã®ã©ã¡ã‚‰ãŒè‰¯ã„ã‹æ±ºã‚ã‚ˆã†ã¨ã„ã†ã‚‚ã®ã§ã¯ãªãã€
ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä»•æ–¹ãŒå…¨ç„¶é•ã†ã®ã§ã€ç‰‡æ–¹ã—ã‹çŸ¥ã‚‰ãªã„äººã«ã¨ã£ã¦ã¯çµæ§‹ã‚®ãƒ£ãƒƒãƒ—ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€ã¨ã„ã†ç¨‹åº¦ã®ã‚‚ã®ã§ã™**ã€‚

# SPAçš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã‚„ã‚Šã¨ã‚Š
SPAçš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€
1. SPAè‡ªä½“ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰
2. ãƒ¦ãƒ¼ã‚¶æ¯ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰

ã®å°‘ãªãã¨ã‚‚2å›ã®HTTPé€šä¿¡ã‚’çµŒã¦ãƒ¦ãƒ¼ã‚¶æ¯ã®ãƒ‡ãƒ¼ã‚¿ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆä¸‹å›³ï¼‰ã€‚
ï¼ˆSPAå…¨ä½“ãŒ1å›ç›®ã§èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã®å¾Œã®å‹•ä½œã¯é«˜é€Ÿã§ã‚ã‚‹ã¨è¨€ã‚ã‚Œã¾ã™ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/5e00e910bd21-20240722.png)

ãƒ¦ãƒ¼ã‚¶æ¯ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰ã§ã¯ [useSWR](https://swr.vercel.app/ja) ã‚„ [tRPC](https://trpc.io/) ç­‰ã‚’ä½¿ã†ã§ã™ã¨ã‹ã€ã‚‚ã£ã¨ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã« [useEffect](https://ja.react.dev/reference/react/useEffect) + [axios](https://www.npmjs.com/package/axios) or [fetch](https://developer.mozilla.org/ja/docs/Web/API/Window/fetch) ç­‰ã€…ã€æ§˜ã€…ãªé¸æŠè‚¢ãŒæœ‰ã‚Šã¾ã™ã€‚
**Client Sideã§ã®ãƒ‡ãƒ¼ã‚¿å–å¾—+å¤‰æ›´ã¯ã€Reactã‚’ä½¿ã£ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆã«ãŠã„ã¦é¿ã‘ã¦ã¯é€šã‚Œãªã„é‡è¦ãªè¦ç´ ã§ã™**ã€‚

# Next.jsçš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—ã®ã‚„ã‚Šã¨ã‚Š
Next.jsçš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€åŸºæœ¬çš„ã«1åº¦ã®HTTPé€šä¿¡ã§ãƒ¦ãƒ¼ã‚¶æ¯ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
ï¼ˆãŸã ã—ãƒšãƒ¼ã‚¸é·ç§»ã‚‚å‰æã«ã—ãŸã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ãŒä¸€åº¦ã«èª­ã¿è¾¼ã¾ã‚Œãªã„æ§‹æˆãŒã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªã®ã§ã€SPAã‚ˆã‚Šãã®å¾Œã®å‹•ä½œã¯é…ã„ã¨è¨€ã‚ã‚Œã¾ã™ï¼‰
![](https://storage.googleapis.com/zenn-user-upload/2453d3ed6799-20240722.png)

Next.jsãŒServer Sideã§ãƒ¦ãƒ¼ã‚¶æ¯ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨HTML+JavaScriptç”Ÿæˆã‚’è¡Œã„ã¾ã™ã€‚
**Client Sideã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç„¡ãã¦ã‚‚è‰¯ã„**ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
**ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã«ã¯Server Actionsã¨ã„ã†æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹**æ–¹æ³•ãŒ[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://nextjs.org/learn/dashboard-app)åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

# ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨å¤‰æ›´ã®ä¾‹
Reactã«ã‚ˆã‚‹SPAã®ä¾‹ã‚’å‰ç½®ãã¨ã—ã¦ã€Next.jsã®å ´åˆãŒã©ã†ãªã‚‹ã‹ã‚’æœ¬é¡Œã¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ä¾‹ç¤ºã—ã¦ã¿ã¾ã™ã€‚
æœ¬å½“ã¯ãƒ¦ãƒ¼ã‚¶å…¥åŠ›ã‚’debounceã—ãŸã„ç­‰ã€å®Ÿç”¨ä¸Šã®å•é¡Œã¯ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€ã€Œã‚ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿å–å¾—å‘¨ã‚Šã®ã‚³ãƒ¼ãƒ‰ãŒå¤§åˆ†é•ã„ãã†ã ãªãƒ¼ã€ã¨ã„ã†æ„Ÿè¦šã‚’æŒã£ã¦é ‚ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

## å‰ç½®ãï¼šReactã«ã‚ˆã‚‹SPA (useSWR + fetch API)
ToDoãƒªã‚¹ãƒˆã‚’useSWRã§å–å¾—ã—ã€å€‹ã€…ã®taskã®æ›´æ–°æ™‚ã«ã¯ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ã¦å†ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚


```TypeScript:TaskList.tsx
import React from 'react';
import useSWR from 'swr';
import { Task } from '@/types';

const TaskList: React.FC = () => {
  // tasks ã¯ Task[] | undfined å‹ã«ãªã‚‹
  // ã§ã‚‚'/api/tasks'ãŒè¿”ã™JSONã®å‹ã‚‚ãã†ãªã£ã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãªã„ã®ã§æ³¨æ„
  // Zodç­‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™
  //
  // Web API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…ã¯çœç•¥ã—ã¾ã™...
  const { data: tasks, mutate } = useSWR<Task[]>(
    '/api/tasks',
    (url: string) => fetch(url).then(r => r.json())
  );

  const updateTask = async (newTask: Task) => {
    await fetch(
      `/api/task/${task.id}',
      { method: 'POST', body: JSON.stringify(newTask) }
    );
    // tasksã‚’å†ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
    await mutate();
  };

  return (
    <>
      {tasks?.map(task =>
        <TaskItem key={task.id} task={task} update={updateTask}/>
      )}
    </>
  );
};
```
```TypeScript:TaskItem.tsx
import React from 'react';
import { Task } from '@/types';

type TaskItemPops = {
  task: Task;
  update: (newTask: Task) => void;
}

const TaskItem: React.FC<TaskItemProps> = ({
  task,
  update,
}) => (
  <input
    defaultValue={task.content}
    onChange={e => update({ ...task, content: e.target.value }) }
  />
);
```

## æœ¬é¡Œï¼šNext.js ã®å ´åˆ
ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®æµã‚ŒãŒSPAã®å ´åˆã¨ã ã„ã¶ç•°ãªã‚Šã¾ã™ã€‚
ãã“ã˜ã‚ƒãªã„ã¨è¨€ã‚ã‚Œãã†ã§ã™ãŒã€å€‹äººçš„ã«ã¯Server Actionsã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãŒè¿½åŠ ã®ä»•çµ„ã¿ç„¡ã—ã§å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ã¨ã“ã‚ãŒã™ã”ãå¥½ãã§ã™ã€‚

ã‚µãƒ¼ãƒå´ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã‚’ã„ã£ãºã‚“ã«æ›¸ã‘ã‚‹ã®ã§ã€ã‚µãƒ¼ãƒä¸Šã«ã‚ã‚‹è¦‹ã›ãŸããªã„ãƒ‡ãƒ¼ã‚¿ãŒé€ä¿¡ã•ã‚Œã¦ã„ãªã„ã‹ï¼Ÿç­‰ã€æ°—ã‚’é£ã†ã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€é¢ç™½ãã¦ä¾¿åˆ©ãªä»•çµ„ã¿ã ã¨æ€ã„ã¾ã™ã€‚
```TypeScript:TaskList.tsx
// Next.jsã§ã¯'use client'ã‚’ä»˜ã‘ãªã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã¯
// ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™

import React from 'react';

// Task[]ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã€Server Actionsã£ã½ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚Œã¾ã—ãŸãŒ
// æ™®é€šã®asyncé–¢æ•°ã§äº‹è¶³ã‚Šã¾ã™
import { getTasks } from '@/actions/tasks';

// Server Componentã¯asyncé–¢æ•°ã«ã§ãã¾ã™
const TaskList: React.FC = async () => {
  const tasks = await getTasks();
  return (
    <>
      {tasks.map(task =>
        <TaskItem key={task.id} task={task} />
      )}
    </>
  );
};
```
```TypeScript:TaskItem.tsx
// onChange ã‚’ä½¿ç”¨ã—ãŸã„ã®ã§Client Componentã¨ã—ã¾ã™
'use client'

import { Task } from '@/types';

// ã‚¿ã‚¹ã‚¯å†…å®¹ã‚’æ›´æ–°ã™ã‚‹Server Action
import { updateTask } from '@/actions/tasks';

type TaskItemProps = {
  task: Task;
}

const TaskItem: React.FC<TaskItemProps> = ({ task }) => (
  <input
    defaultValue={task.content}
    onChange={async e => await updateTask({
      ...task, content: e.target.value
    })}
  />
);
```
```TypeScript:@/actions/tasks.ts
// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Server Actionsã‚’å®šç¾©ã—ã¦ã„ã¾ã™
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®form actionã‚„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ã¨
// POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã«è‡ªå‹•çš„ã«å¤‰æ›ã•ã‚Œã¦é€šä¿¡ãŒè¡Œã‚ã‚Œã¾ã™
'use server'

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®TypeScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯è‰²ã€…ã‚ã‚Šã¾ã™ãŒ
// Drizzle ORMã‚’ä¾‹ã«ç”¨ã„ã¾ã™
import { tasks } from '@/db/schema';
import { db } from '@/db';
import { eq, and } from 'drizzle-orm';

// ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã€Auth.jsã‚’ä½¿ã£ãŸæ©Ÿèƒ½ã§ã™
// ä¸€èˆ¬çš„ãªå†…å®¹ã‚„ä½¿ã„æ–¹ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ãã ã•ã„...
import { auth } from '@/auth';

// ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ãƒ¦ãƒ¼ã‚¶IDã‚’è¿”ã—ã€ãã†ã§ãªã„ãªã‚‰ä¾‹å¤–ã¨ã—ã¾ã™
// Auth.jsãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Userå‹ã«åˆã‚ã›ã¦ã„ã¾ã™ãŒã€
// è‡ªåˆ†ã§å®šç¾©ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™
async function getUserId() {
  const session = await auth();
  if (session?.user?.name == null) {
    throw new Error('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“');
  }
  return session.user.name;
}

// ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®Server Action
export async function getTasks() {
  const userId = await getUser();
  return await db
    .select()
    .from(tasks)
    .where(eq(tasks.userId, userId));
}

// ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®Server Action
export async function updateTask(newTask: Task) {
  const userIdFromSession = await getUser();
  const { id, useId: _doNotUseUserIdFromClient, ...params } = newTask;
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã§é€ã‚‰ã‚Œã¦ãã‚‹userIdã¯ä¿¡é ¼ã§ãã‚‹ã¨ã¯é™ã‚‰ãªã„ã®ã§ã€
  // æš—å·åŒ–ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã•ã‚ŒãŸuserIdã®ã¿ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™
  await db
    .update(tasks)
    .set({ ...params })
    .where(
      and(
        eq(tasks.id, id),
        eq(tasks.userId, userIdFromSession)
      )
    );
}
```
ã‚µãƒ¼ãƒå´ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãã‚Œã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹æµã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ä¾‹ã«ã¤ã„ã¦
ã‚³ãƒ¼ãƒ‰ä¾‹ã¯Next.jsã‚’å‹•ä½œã•ã›ã‚‹ã®ã«å¿…è¦ãªè¨˜è¿°ã‚’ç¶²ç¾…ã§ãã¦ã„ã¾ã›ã‚“ã€‚
é–‹ç™ºä¸­ã®ã“ã¡ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã€ä¸Šè¨˜ã®æµã‚Œã«æ²¿ã£ãŸã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚
https://github.com/Daiius/sekirei-todo

# çµè«–
Static Renderingã«ãªã‚‹ãƒšãƒ¼ã‚¸ã‚’å¢—ã‚„ã™æ–¹ãŒè‰¯ã„ã®ã ã‚ã†ã‹...ã¨ã‹ã€
Next.jsã¨ã¯ã„ãˆWeb APIç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å¿…è¦ãªã®ã§ã¯ãªã„ã ã‚ã†ã‹...ã¨ã‹ã€
è‰²ã€…è€ƒãˆãŸã®ã§ã™ãŒã€ä»–ã«åˆ¶ç´„ãŒç„¡ã‘ã‚Œã°ã€ŒHTTPé€šä¿¡ã®å¾€å¾©ã‚’æœ€ä½é™ã«ã™ã‚‹ã€ã¨ã„ã†æ–¹é‡ã§è‡ªç„¶ãªNext.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›¸ã‘ã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ãã‚Œã§ã¯ã€è‰¯ã„Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’ï¼
