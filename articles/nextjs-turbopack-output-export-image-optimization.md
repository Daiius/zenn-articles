---
title: 'Next.js v16 + turbopack + output: "export" で動く画像最適化ライブラリを試作する話'
emoji: "🖼️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nextjs"]
published: false
---

# まとめ

Next.js を `output: "export"` で使用する際、画像最適化を助けてくれるライブラリがいくつかあります。

これらは webpack loader の呼び出しが前提に設計されており、turbopack では動作しないないものが多いです。

そこで turbopack の制約に合わせて画像 import 時に出力されるjsコードにマーカーを埋め込み、それを元に最適化画像を生成させる仕組みを試作しました。

# 背景

Vercel にアップロードした時は Next.js + Vercel がよしなにしてくれる部分ですが、

# 下書き

:::details 画像最適化について...
8Kディスプレイからスマホまで、Webページが表示されうる画面サイズは多岐に渡ります。

大きい画面で見る際に小さい画像が拡大されるとボヤけたりギザギザに表示され、ユーザ体験が良くないです。

だからと言って全デバイス向けに大きな画像を使用すると通信データ量が増え、ユーザのスマホのギガ消費の観点だけでなく、 運用時コストが通信量に依存するならコスト増になります。

そこで、

- 表示するサイズに合わせた画像を読み込む
- png や jpeg より圧縮率の高い webp や avif といったフォーマットに画像を変換する

という 2 つの仕組みを併用し、より効率良く適切なサイズの画像を配布しようという技術を指して「画像最適化」と呼んでいます。

ちょっと社でも画像データのサイズには特に気を付けています！
:::
